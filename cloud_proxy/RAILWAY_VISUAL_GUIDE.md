# Визуальное руководство: Railway.app

## Что вы увидите на каждом шаге

---

## ШАГ 1: Регистрация

### Экран 1: Главная страница Railway

```
┌─────────────────────────────────────────┐
│  Railway.app                             │
│                                          │
│  [Start a New Project]  [Login]         │
│                                          │
│  Deploy apps in minutes                 │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"Login"**

### Экран 2: Выбор способа входа

```
┌─────────────────────────────────────────┐
│  Login to Railway                       │
│                                          │
│  [Login with GitHub]  ⭐                │
│  [Login with Email]                     │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"Login with GitHub"**

### Экран 3: Авторизация GitHub

```
┌─────────────────────────────────────────┐
│  GitHub                                  │
│                                          │
│  Railway.app wants to access your        │
│  GitHub account                          │
│                                          │
│  [Cancel]  [Authorize railway]          │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"Authorize railway"**

**Результат:** Вы попадете в панель управления Railway

---

## ШАГ 2: Создание проекта

### Экран 1: Панель управления

```
┌─────────────────────────────────────────┐
│  Railway Dashboard                       │
│                                          │
│  [+ New]  [Projects]  [Settings]        │
│                                          │
│  No projects yet                         │
│  [New Project]                           │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"+ New"** → **"Project"**

### Экран 2: Выбор источника

```
┌─────────────────────────────────────────┐
│  Create New Project                      │
│                                          │
│  How do you want to deploy?             │
│                                          │
│  ┌───────────────────────────────────┐ │
│  │ Deploy from GitHub repo  ⭐        │ │
│  │ Connect your GitHub repository     │ │
│  └───────────────────────────────────┘ │
│                                          │
│  ┌───────────────────────────────────┐ │
│  │ Empty Project                      │ │
│  │ Start from scratch                 │ │
│  └───────────────────────────────────┘ │
│                                          │
│  ┌───────────────────────────────────┐ │
│  │ Deploy from Template              │ │
│  │ Use a pre-built template          │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите на **"Deploy from GitHub repo"**

### Экран 3: Выбор репозитория

```
┌─────────────────────────────────────────┐
│  Select Repository                       │
│                                          │
│  Your Repositories:                     │
│                                          │
│  ┌───────────────────────────────────┐ │
│  │ Smart-Column-S3                    │ │
│  │ Description: ...                    │ │
│  │ [Select]                            │ │
│  └───────────────────────────────────┘ │
│                                          │
│  [Configure GitHub App]                  │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"Select"** на репозитории Smart-Column-S3

**Если репозитория нет:**
1. Нажмите **"Configure GitHub App"**
2. Выберите репозиторий
3. Нажмите **"Install"**

---

## ШАГ 3: Настройка Root Directory

### Экран: Configure Service

```
┌─────────────────────────────────────────┐
│  Configure Service                       │
│                                          │
│  Repository: Smart-Column-S3            │
│                                          │
│  Root Directory:                         │
│  ┌───────────────────────────────────┐ │
│  │ cloud_proxy                        │ ← Введите это
│  └───────────────────────────────────┘ │
│                                          │
│  Detected:                               │
│  ✅ Framework: Node.js                   │
│  ✅ Build: npm install                    │
│  ✅ Start: npm start                      │
│                                          │
│  [Cancel]  [Deploy]                      │
└─────────────────────────────────────────┘
```

**Действие:** 
1. В поле "Root Directory" введите: `cloud_proxy`
2. Проверьте, что все определено правильно
3. Нажмите **"Deploy"**

**⚠️ Важно:** Не оставляйте Root Directory пустым!

---

## ШАГ 4: Переменные окружения

### Экран 1: Панель проекта

```
┌─────────────────────────────────────────┐
│  smart-column-proxy                     │
│                                          │
│  [Overview] [Deployments] [Variables]    │
│  [Settings] [Metrics] [Logs]           │
│                                          │
│  Status: Deploying...                    │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите на вкладку **"Variables"**

### Экран 2: Список переменных (пустой)

```
┌─────────────────────────────────────────┐
│  Environment Variables                   │
│                                          │
│  No variables set                        │
│                                          │
│  [+ New Variable]                        │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"+ New Variable"**

### Экран 3: Добавление ESP32_TOKEN

```
┌─────────────────────────────────────────┐
│  Add Variable                           │
│                                          │
│  Name:                                   │
│  ┌───────────────────────────────────┐ │
│  │ ESP32_TOKEN                        │ ← Введите
│  └───────────────────────────────────┘ │
│                                          │
│  Value:                                  │
│  ┌───────────────────────────────────┐ │
│  │ a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6 │ ← Вставьте токен
│  └───────────────────────────────────┘ │
│                                          │
│  [Cancel]  [Add]                         │
└─────────────────────────────────────────┘
```

**Действие:**
1. В поле "Name" введите: `ESP32_TOKEN`
2. В поле "Value" вставьте сгенерированный токен
3. Нажмите **"Add"**

### Экран 4: Добавление CLIENT_TOKEN

Повторите шаг 3, но:
- **Name:** `CLIENT_TOKEN`
- **Value:** другой токен (не тот же, что для ESP32!)

### Экран 5: Список переменных (заполнен)

```
┌─────────────────────────────────────────┐
│  Environment Variables                   │
│                                          │
│  Name              Value                │
│  ─────────────────────────────────────  │
│  ESP32_TOKEN       [••••••••]          │
│  CLIENT_TOKEN      [••••••••]          │
│  PORT              3000                 │
│                                          │
│  [+ New Variable]                        │
└─────────────────────────────────────────┘
```

**Результат:** Переменные добавлены, Railway перезапустит сервис

---

## ШАГ 5: Получение URL

### Экран: Settings → Networking

```
┌─────────────────────────────────────────┐
│  Settings                                │
│                                          │
│  [General] [Networking] [Resources]     │
│                                          │
│  Networking                              │
│  ─────────────────────────────────────  │
│                                          │
│  Domain:                                 │
│  ┌───────────────────────────────────┐ │
│  │ [Generate Domain]                   │ ← Нажмите
│  └───────────────────────────────────┘ │
│                                          │
│  Custom Domain:                          │
│  (Optional)                              │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"Generate Domain"**

### Результат: Домен создан

```
┌─────────────────────────────────────────┐
│  Domain Generated                        │
│                                          │
│  Your domain:                            │
│  ┌───────────────────────────────────┐ │
│  │ smart-column-proxy-production.     │ │
│  │     up.railway.app                 │ │
│  │ [Copy]                              │ │
│  └───────────────────────────────────┘ │
│                                          │
│  ✅ HTTPS enabled automatically          │
└─────────────────────────────────────────┘
```

**Действие:** Скопируйте URL (нажмите **"Copy"**)

---

## ШАГ 6: Проверка работы

### Проверка в браузере

Откройте:
```
https://smart-column-proxy-production.up.railway.app/health
```

**Ожидаемый результат:**
```json
{
  "status": "ok",
  "timestamp": 1703123456789,
  "devicesCount": 0
}
```

Если видите этот JSON - сервер работает! ✅

### Просмотр логов

```
┌─────────────────────────────────────────┐
│  Deployments                             │
│                                          │
│  Latest Deployment                       │
│  ─────────────────────────────────────  │
│  Status: ✅ Success                      │
│  Time: 2 minutes ago                     │
│                                          │
│  [View Logs]                             │
└─────────────────────────────────────────┘
```

**Действие:** Нажмите **"View Logs"**

**Ожидаемые логи:**
```
=================================
Smart-Column S3 Cloud Proxy
=================================
Server running on port 3000
ESP32 endpoint: ws://localhost:3000/esp32
Client endpoint: ws://localhost:3000/client
HTTP API: http://localhost:3000/api
=================================
```

---

## ШАГ 7: Использование в приложении

### Экран: Настройки устройства

```
┌─────────────────────────────────────────┐
│  Настройки устройства                   │
│                                          │
│  Название:                               │
│  [Моя колонна (удаленно)        ]       │
│                                          │
│  Хост:                                   │
│  [smart-column-proxy-production.       │
│   up.railway.app                ]       │
│                                          │
│  Порт:                                   │
│  [443                            ]      │
│                                          │
│  ☑ Облачный прокси                      │
│                                          │
│  Device ID:                              │
│  [esp32-001                      ]      │
│                                          │
│  Токен прокси:                           │
│  [••••••••••••••••              ]      │
│                                          │
│  ☑ HTTPS (автоматически)                │
│                                          │
│  [Проверить подключение]                │
│  [Сохранить]                             │
└─────────────────────────────────────────┘
```

**Заполните:**
- Хост: URL из шага 5
- Device ID: `esp32-001` (или другой уникальный)
- Токен прокси: ваш `CLIENT_TOKEN` из шага 4

---

## Типичные ошибки и решения

### Ошибка: "Build failed"

**Что видите:**
```
❌ Build failed
Error: Cannot find module 'express'
```

**Решение:**
1. Проверьте Root Directory = `cloud_proxy`
2. Убедитесь, что `package.json` в папке `cloud_proxy`

### Ошибка: "Port 3000 already in use"

**Что видите:**
```
Error: Port 3000 is already in use
```

**Решение:**
- Это нормально, Railway автоматически устанавливает PORT
- Убедитесь, что в коде используется `process.env.PORT`

### Ошибка: "Cannot connect"

**Что видите в приложении:**
```
Ошибка подключения: Connection refused
```

**Решение:**
1. Проверьте, что сервер развернут (Deployments → Success)
2. Проверьте URL (должен быть с `https://`)
3. Проверьте токен (должен быть CLIENT_TOKEN, не ESP32_TOKEN)

---

## Чек-лист развертывания

Пройдитесь по списку:

- [ ] Зарегистрировались на Railway
- [ ] Создали проект
- [ ] Указали Root Directory = `cloud_proxy`
- [ ] Добавили переменную `ESP32_TOKEN`
- [ ] Добавили переменную `CLIENT_TOKEN`
- [ ] Сгенерировали домен
- [ ] Скопировали URL
- [ ] Проверили `/health` endpoint
- [ ] Настроили Android приложение
- [ ] Проверили подключение

**Если все пункты отмечены - готово! ✅**

