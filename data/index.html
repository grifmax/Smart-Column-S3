<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Column S3</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="column-animation.css">
    <link rel="stylesheet" href="schemes-animation.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header>
            <h1>üè≠ Smart-Column S3</h1>
            <div class="status-bar">
                <span id="connection-status" class="status-dot offline">‚óè</span>
                <span id="connection-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                <span class="uptime">Uptime: <span id="uptime">--:--:--</span></span>
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="tabs">
            <button class="tab active" data-tab="monitor">üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
            <button class="tab" data-tab="control">üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
            <button class="tab" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" data-tab="logs">üìù –õ–æ–≥–∏</button>
            <a href="charts.html" class="tab" style="text-decoration: none;">üìà –ì—Ä–∞—Ñ–∏–∫–∏</a>
            <a href="calibration.html" class="tab" style="text-decoration: none;">üîß –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞</a>
        </nav>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ -->
        <div id="monitor" class="tab-content active">
            <div class="cards">
                <!-- –†–µ–∂–∏–º –∏ —Ñ–∞–∑–∞ -->
                <div class="card">
                    <h2>–°—Ç–∞—Ç—É—Å</h2>
                    <div class="big-value">
                        <div class="label">–†–µ–∂–∏–º</div>
                        <div id="mode" class="value mode-idle">IDLE</div>
                    </div>
                    <div class="big-value">
                        <div class="label">–§–∞–∑–∞</div>
                        <div id="phase" class="value">‚Äî</div>
                    </div>
                </div>

                <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã -->
                <div class="card">
                    <h2>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h2>
                    <div class="metrics">
                        <div class="metric">
                            <span class="metric-label">–ö—É–±</span>
                            <span id="temp-cube" class="metric-value">--¬∞C</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–¶–∞—Ä–≥–∞ –Ω–∏–∑</span>
                            <span id="temp-column-bottom" class="metric-value">--¬∞C</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–¶–∞—Ä–≥–∞ –≤–µ—Ä—Ö</span>
                            <span id="temp-column-top" class="metric-value">--¬∞C</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–î–µ—Ñ–ª–µ–≥–º–∞—Ç–æ—Ä</span>
                            <span id="temp-reflux" class="metric-value">--¬∞C</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–¢–°–ê</span>
                            <span id="temp-tsa" class="metric-value">--¬∞C</span>
                        </div>
                    </div>
                </div>

                <!-- –î–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="card">
                    <h2>üìà –î–∞–≤–ª–µ–Ω–∏–µ</h2>
                    <div class="metrics">
                        <div class="metric">
                            <span class="metric-label">–ö—É–±</span>
                            <span id="pressure-cube" class="metric-value">-- –º–º —Ä—Ç.—Å—Ç.</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ</span>
                            <span id="pressure-atm" class="metric-value">-- –≥–ü–∞</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ü–æ—Ä–æ–≥ –∑–∞—Ö–ª—ë–±–∞</span>
                            <span id="pressure-flood" class="metric-value">-- –º–º</span>
                        </div>
                    </div>
                </div>

                <!-- –ú–æ—â–Ω–æ—Å—Ç—å -->
                <div class="card">
                    <h2>‚ö° –≠–ª–µ–∫—Ç—Ä–æ–ø–∏—Ç–∞–Ω–∏–µ (PZEM-004T)</h2>
                    <div class="metrics">
                        <div class="metric">
                            <span class="metric-label">–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ</span>
                            <span id="power-voltage" class="metric-value">-- V</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–¢–æ–∫</span>
                            <span id="power-current" class="metric-value">-- A</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ú–æ—â–Ω–æ—Å—Ç—å</span>
                            <span id="power-power" class="metric-value">-- W</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–≠–Ω–µ—Ä–≥–∏—è</span>
                            <span id="power-energy" class="metric-value">-- –∫–í—Ç¬∑—á</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ß–∞—Å—Ç–æ—Ç–∞</span>
                            <span id="power-frequency" class="metric-value">-- –ì—Ü</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ö–æ—ç—Ñ—Ñ. –º–æ—â–Ω–æ—Å—Ç–∏</span>
                            <span id="power-pf" class="metric-value">--</span>
                        </div>
                    </div>
                </div>

                <!-- –ù–∞—Å–æ—Å –∏ –æ—Ç–±–æ—Ä -->
                <div class="card">
                    <h2>üíß –ù–∞—Å–æ—Å –∏ –æ—Ç–±–æ—Ä</h2>
                    <div class="metrics">
                        <div class="metric">
                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                            <span id="pump-speed" class="metric-value">-- –º–ª/—á</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–û–±—ä—ë–º</span>
                            <span id="pump-volume" class="metric-value">-- –º–ª</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–ì–æ–ª–æ–≤—ã</span>
                            <span id="volume-heads" class="metric-value">-- –º–ª</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–¢–µ–ª–æ</span>
                            <span id="volume-body" class="metric-value">-- –º–ª</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">–•–≤–æ—Å—Ç—ã</span>
                            <span id="volume-tails" class="metric-value">-- –º–ª</span>
                        </div>
                    </div>
                </div>

                <!-- –ê—Ä–µ–æ–º–µ—Ç—Ä -->
                <div class="card">
                    <h2>üç∑ –ê—Ä–µ–æ–º–µ—Ç—Ä</h2>
                    <div class="big-value">
                        <div class="label">–ö—Ä–µ–ø–æ—Å—Ç—å</div>
                        <div id="abv" class="value">--%</div>
                    </div>
                </div>

                <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –∫–æ–ª–æ–Ω–Ω—ã -->
                <div class="card">
                    <h2>üè≠ –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞</h2>
                    <div class="scheme-container" style="display: flex; justify-content: center; padding: 10px;">
                        <object data="schemes/column-animated.svg" type="image/svg+xml" style="width: 100%; max-width: 500px; height: auto;"></object>
                    </div>
                </div>

                <!-- –ú–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä -->
                <div class="card">
                    <h2>üìà –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (5 –º–∏–Ω)</h2>
                    <div id="mini-chart" style="width: 100%; height: 200px;"></div>
                    <div style="text-align: center; margin-top: 10px;">
                        <a href="charts.html" class="btn btn-primary btn-sm">üìä –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div id="control" class="tab-content">
            <div class="cards">
                <div class="card">
                    <h2>–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞</h2>
                    <div class="controls">
                        <button class="btn btn-success" onclick="startRectification()">‚ñ∂Ô∏è –ê–≤—Ç–æ-—Ä–µ–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</button>
                        <button class="btn btn-warning" onclick="startManual()">üéõÔ∏è –†—É—á–Ω–∞—è —Ä–µ–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</button>
                        <button class="btn btn-info" onclick="startDistillation()">üè∫ –î–∏—Å—Ç–∏–ª–ª—è—Ü–∏—è</button>
                    </div>
                    <div class="controls">
                        <button class="btn btn-danger" onclick="stopProcess()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button class="btn" onclick="pauseProcess()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                        <button class="btn" onclick="resumeProcess()">‚èØÔ∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                    </div>
                </div>

                <div class="card">
                    <h2>–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                    <div class="control-group">
                        <label for="heater-power">–ú–æ—â–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä–µ–≤–∞: <span id="heater-value">0</span>%</label>
                        <input type="range" id="heater-power" min="0" max="100" value="0"
                               oninput="updateHeater(this.value)">
                    </div>
                    <div class="control-group">
                        <label for="pump-speed-control">–°–∫–æ—Ä–æ—Å—Ç—å –Ω–∞—Å–æ—Å–∞: <span id="pump-value">0</span> –º–ª/—á</label>
                        <input type="range" id="pump-speed-control" min="0" max="500" value="0"
                               oninput="updatePump(this.value)">
                    </div>
                    <div class="control-group">
                        <label>–ö–ª–∞–ø–∞–Ω—ã</label>
                        <div class="controls">
                            <button class="btn btn-sm" onclick="toggleValve('water')">üíß –í–æ–¥–∞</button>
                            <button class="btn btn-sm" onclick="toggleValve('heads')">ü•É –ì–æ–ª–æ–≤—ã</button>
                            <button class="btn btn-sm" onclick="toggleValve('uno')">üîÑ –£–ù–û</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settings" class="tab-content">
            <div class="cards">
                <div class="card">
                    <h2>WiFi</h2>
                    <div class="form-group">
                        <label>SSID</label>
                        <input type="text" id="wifi-ssid" placeholder="–ò–º—è —Å–µ—Ç–∏">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="wifi-password" placeholder="–ü–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-primary" onclick="saveWiFi()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>

                <div class="card">
                    <h2>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h2>
                    <div class="form-group">
                        <label>–ú–æ—â–Ω–æ—Å—Ç—å –¢–≠–ù–∞ (–í—Ç)</label>
                        <input type="number" id="heater-power-w" value="3000" min="1000" max="10000">
                    </div>
                    <div class="form-group">
                        <label>–í—ã—Å–æ—Ç–∞ —Ü–∞—Ä–≥–∏ (–º–º)</label>
                        <input type="number" id="column-height" value="1500" min="500" max="3000">
                    </div>
                    <button class="btn btn-primary" onclick="saveEquipment()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>

                <div class="card">
                    <h2>–¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
                    <div class="controls">
                        <button class="btn" onclick="setTheme('light')">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
                        <button class="btn" onclick="setTheme('dark')">üåô –¢—ë–º–Ω–∞—è</button>
                    </div>
                </div>

                <div class="card">
                    <h2>–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="show-memory-stats" onchange="toggleMemoryStats()">
                            <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞–º—è—Ç–∏ –≤ —Ñ—É—Ç–µ—Ä–µ</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –õ–æ–≥–∏ -->
        <div id="logs" class="tab-content">
            <div class="card">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
                <div id="log-container" class="log-container">
                    <div class="log-entry">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–∏—Å—Ç–µ–º–µ...</div>
                </div>
                <button class="btn" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="btn btn-primary" onclick="downloadLogs()">üíæ –°–∫–∞—á–∞—Ç—å CSV</button>
            </div>
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <footer>
            <p>Smart-Column S3 v1.1.0 | ESP32-S3 DevKitC-1 N16R8</p>
            <div id="memory-stats" style="display: none; margin-top: 10px; font-size: 0.75em; color: var(--text-secondary); line-height: 1.4;">
                <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
                    <span>üíæ SRAM: <span id="mem-heap-used">--</span> / <span id="mem-heap-total">--</span> (<span id="mem-heap-pct">--%</span>)</span>
                    <span>üß† PSRAM: <span id="mem-psram-free">--</span> / <span id="mem-psram-total">--</span></span>
                    <span>üì¶ Flash: <span id="mem-flash-pct">--%</span></span>
                </div>
            </div>
        </footer>
    </div>

    <script src="column-animation.js"></script>
    <script src="app.js"></script>
</body>
</html>
