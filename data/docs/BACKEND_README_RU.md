# Smart-Column S3 - Backend –Ω–∞ spiritcontrol.ru

## üéØ –ß—Ç–æ —ç—Ç–æ?

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π PHP –±—ç–∫–µ–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ ESP32, –Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ spiritcontrol.ru. –í—Å–µ API endpoints –∏–¥–µ–Ω—Ç–∏—á–Ω—ã ESP32 –≤–µ—Ä—Å–∏–∏.

## ‚úÖ –§—É–Ω–∫—Ü–∏–∏

- ‚úÖ HTTP Basic Authentication (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
- ‚úÖ –í—Å–µ API endpoints –∫–∞–∫ –Ω–∞ ESP32
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ JSON —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º PHP 7.4+

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```
backend.php    - –æ—Å–Ω–æ–≤–Ω–æ–π API —Ñ–∞–π–ª
auth.php       - —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏  
.htaccess      - –ø—Ä–∞–≤–∏–ª–∞ Apache
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
chmod 644 backend.php auth.php .htaccess
chmod 755 cloud_proxy/
```

### 3. –ì–æ—Ç–æ–≤–æ!

–§–∞–π–ª—ã `state.json`, `settings.json`, `calibration.json`, `users.json` —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üîê –í—Ö–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–í–ê–ñ–ù–û! –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏!**

- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin`

## üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

```bash
curl https://spiritcontrol.ru/health
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

```bash
curl -u admin:admin https://spiritcontrol.ru/api/status
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
curl -u admin:admin -X POST \
  -H "Content-Type: application/json" \
  -d '{"mode": "rectification"}' \
  https://spiritcontrol.ru/api/process/start
```

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```
URL: spiritcontrol.ru
–ü–æ—Ä—Ç: 443 (HTTPS) –∏–ª–∏ 80 (HTTP)
HTTPS: ‚úÖ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ SSL)
–õ–æ–≥–∏–Ω: admin
–ü–∞—Ä–æ–ª—å: [–≤–∞—à –ø–∞—Ä–æ–ª—å]
```

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ API endpoints

- `GET /api/status` - –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `GET /api/health` - –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã  
- `POST /api/process/start` - –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `POST /api/process/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `POST /api/process/pause` - –ü–∞—É–∑–∞
- `POST /api/process/resume` - –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `GET /api/calibration` - –ü–æ–ª—É—á–∏—Ç—å –∫–∞–ª–∏–±—Ä–æ–≤–∫—É
- `POST /api/calibration/pump` - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–∞
- `POST /api/pump/start` - –ó–∞–ø—É—Å–∫ –Ω–∞—Å–æ—Å–∞
- `POST /api/pump/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–∞
- `GET /api/pump/status` - –°—Ç–∞—Ç—É—Å –Ω–∞—Å–æ—Å–∞
- `POST /api/heater/power` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ—â–Ω–æ—Å—Ç—å –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è
- –ò –¥—Ä—É–≥–∏–µ...

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ `BACKEND_SETUP.md`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!**
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
3. –î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã —Ñ–∞–π–ª–æ–≤ `*.json`
4. –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ `users.json` –≤ –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
cloud_proxy/
‚îú‚îÄ‚îÄ backend.php          # –û—Å–Ω–æ–≤–Ω–æ–π API
‚îú‚îÄ‚îÄ auth.php             # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .htaccess            # –ü—Ä–∞–≤–∏–ª–∞ Apache
‚îú‚îÄ‚îÄ state.json           # –°–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ settings.json        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ calibration.json     # –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ users.json           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## ‚ùì –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ 401 Unauthorized
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin:admin`)

### –û—à–∏–±–∫–∞ 500 Internal Server Error
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `chmod 666 *.json`

### –§–∞–π–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å: `chmod 777 cloud_proxy/`

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `BACKEND_SETUP.md`

