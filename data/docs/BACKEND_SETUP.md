# Smart-Column S3 - Backend Setup

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π PHP –±—ç–∫–µ–Ω–¥ –¥–ª—è Smart-Column S3, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ ESP32, –Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ spiritcontrol.ru.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ HTTP Basic Authentication (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
- ‚úÖ –í—Å–µ API endpoints –∫–∞–∫ –Ω–∞ ESP32
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ JSON —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º PHP (7.4+)

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4 –∏–ª–∏ –≤—ã—à–µ
- Apache —Å mod_rewrite (–∏–ª–∏ Nginx)
- –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–¥–ª—è JSON —Ñ–∞–π–ª–æ–≤)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ spiritcontrol.ru

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã

–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- `backend.php` - –æ—Å–Ω–æ–≤–Ω–æ–π API —Ñ–∞–π–ª
- `auth.php` - —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `config.php` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- `.htaccess` - –ø—Ä–∞–≤–∏–ª–∞ Apache

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
chmod 644 backend.php auth.php config.php .htaccess
chmod 755 cloud_proxy/
chmod 666 state.json settings.json calibration.json users.json  # –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–§–∞–π–ª—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:
- `state.json` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `settings.json` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `calibration.json` - –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- `users.json` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω `spiritcontrol.ru` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —Ñ–∞–π–ª–∞–º–∏.

### –®–∞–≥ 5: –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!

**–í–ê–ñ–ù–û!** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin`

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏!

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `admin` (–∏–∑–º–µ–Ω–∏—Ç–µ!)

### HTTP Basic Authentication

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ `/health`) —Ç—Ä–µ–±—É—é—Ç HTTP Basic Authentication:

```bash
curl -u admin:admin https://spiritcontrol.ru/api/status
```

–ò–ª–∏ –≤ –∫–æ–¥–µ:

```javascript
fetch('https://spiritcontrol.ru/api/status', {
  headers: {
    'Authorization': 'Basic ' + btoa('admin:admin')
  }
})
```

## üì° API Endpoints

### –°—Ç–∞—Ç—É—Å

- `GET /api/status` - –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `GET /api/health` - –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
- `GET /api/version` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏

### –ü—Ä–æ—Ü–µ—Å—Å—ã

- `POST /api/process/start` - –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `POST /api/process/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `POST /api/process/pause` - –ü–∞—É–∑–∞
- `POST /api/process/resume` - –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- `GET /api/settings/demo` - –ü–æ–ª—É—á–∏—Ç—å –¥–µ–º–æ-—Ä–µ–∂–∏–º
- `POST /api/settings/demo` - –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –¥–µ–º–æ-—Ä–µ–∂–∏–º

### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞

- `GET /api/calibration` - –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- `POST /api/calibration/pump` - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–∞
- `POST /api/calibration/temp` - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–æ–≤
- `POST /api/calibration/hydrometer` - –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞
- `GET /api/calibration/scan` - –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤

### –ù–∞—Å–æ—Å

- `GET /api/pump/status` - –°—Ç–∞—Ç—É—Å –Ω–∞—Å–æ—Å–∞
- `POST /api/pump/start` - –ó–∞–ø—É—Å–∫ –Ω–∞—Å–æ—Å–∞
- `POST /api/pump/stop` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Å–æ—Å–∞

### –ù–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å

- `POST /api/heater/power` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ—â–Ω–æ—Å—Ç—å (0-100%)

### –°–∏—Å—Ç–µ–º–∞

- `POST /api/reboot` - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```
URL: spiritcontrol.ru
–ü–æ—Ä—Ç: 443 (–¥–ª—è HTTPS) –∏–ª–∏ 80 (–¥–ª—è HTTP)
HTTPS: ‚úÖ –í–∫–ª—é—á–µ–Ω–æ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSL)
–õ–æ–≥–∏–Ω: admin
–ü–∞—Ä–æ–ª—å: [–≤–∞—à –ø–∞—Ä–æ–ª—å]
```

**–í–∞–∂–Ω–æ:** Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å HTTP Basic Auth –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤.

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
curl https://spiritcontrol.ru/health
```

–û—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "timestamp": 1702123456,
  "server": "Smart-Column S3 Backend",
  "version": "1.0.0"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl -u admin:admin https://spiritcontrol.ru/api/status
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
curl -u admin:admin -X POST \
  -H "Content-Type: application/json" \
  -d '{"mode": "rectification"}' \
  https://spiritcontrol.ru/api/process/start
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ—â–Ω–æ—Å—Ç–∏ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è

```bash
curl -u admin:admin -X POST \
  -H "Content-Type: application/json" \
  -d '{"power": 75}' \
  https://spiritcontrol.ru/api/heater/power
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ .htaccess –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** —Ñ–∞–π–ª–æ–≤ `*.json`
5. **–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ** —Ñ–∞–π–ª `users.json` –≤ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

–ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤ `users.json`. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:

1. –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª `users.json`
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `admin:admin`
3. –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–¥ (–±—É–¥—É—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
cloud_proxy/
‚îú‚îÄ‚îÄ backend.php          # –û—Å–Ω–æ–≤–Ω–æ–π API —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ auth.php             # –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ config.php           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .htaccess            # –ü—Ä–∞–≤–∏–ª–∞ Apache
‚îú‚îÄ‚îÄ state.json           # –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ settings.json        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ calibration.json     # –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ users.json           # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ 401 Unauthorized

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin:admin`

### –û—à–∏–±–∫–∞ 500 Internal Server Error

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
chmod 666 state.json settings.json calibration.json users.json
chmod 755 cloud_proxy/
```

### –§–∞–π–ª—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
chmod 777 cloud_proxy/  # –í—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞
# –ò–ª–∏
touch state.json settings.json calibration.json users.json
chmod 666 *.json
```

### mod_rewrite –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ backend.php

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ mod_rewrite –≤–∫–ª—é—á–µ–Ω: `a2enmod rewrite`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.htaccess` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (AllowOverride All)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `backend.php?path=/api/status` –Ω–∞–ø—Ä—è–º—É—é

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞:

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ `backend.php` –∏ `auth.php`
2. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø —Ñ–∞–π–ª–æ–≤ `*.json`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `/health`

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ PHP (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
2. –õ–æ–≥–∏ Apache/Nginx
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
4. –í–µ—Ä—Å–∏—é PHP (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 7.4+)

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ –Ω–∞ spiritcontrol.ru! üéâ

