# Удаленный доступ через интернет

## Варианты организации удаленного доступа

### 1. VPN (Рекомендуется) ⭐

**Преимущества:**
- Безопасность (шифрование всего трафика)
- Не нужно менять код приложения
- Работает как в локальной сети

**Что нужно:**
- VPN сервер (WireGuard, OpenVPN, Tailscale)
- Настроить VPN на роутере или отдельном устройстве
- Подключиться к VPN с телефона

**Настройка приложения:** Не требуется изменений, используйте локальный IP устройства в VPN сети.

---

### 2. Port Forwarding + DDNS

**Преимущества:**
- Прямой доступ к устройству
- Не нужен промежуточный сервер

**Недостатки:**
- Нужен статический IP или DDNS
- Открытие портов на роутере (риск безопасности)
- Рекомендуется HTTPS

**Что нужно:**
1. Настроить DDNS (например, No-IP, DuckDNS)
2. Пробросить порт на роутере (например, 80 → внешний порт)
3. Настроить HTTPS на ESP32 (см. ниже)

**Настройка приложения:** Указать доменное имя вместо IP.

---

### 3. Cloud Tunnel (ngrok, Cloudflare Tunnel)

**Преимущества:**
- Не нужно настраивать роутер
- Автоматический HTTPS
- Простая настройка

**Недостатки:**
- Зависимость от внешнего сервиса
- Может быть платным для постоянного использования

**Что нужно:**
- Установить ngrok/Cloudflare Tunnel на устройство рядом с ESP32
- Получить публичный URL

**Настройка приложения:** Использовать предоставленный URL.

---

### 4. MQTT через облачный брокер

**Преимущества:**
- Уже реализовано в проекте
- Безопасность через TLS
- Масштабируемость

**Недостатки:**
- Нужно переписать приложение для работы через MQTT
- Нет прямого доступа к Web UI

**Что нужно:**
- Облачный MQTT брокер (HiveMQ, Mosquitto, AWS IoT)
- Настроить MQTT на ESP32 с TLS

---

### 5. Облачный прокси-сервер

**Преимущества:**
- Полный контроль
- Можно добавить дополнительную аутентификацию

**Недостатки:**
- Нужен собственный сервер
- Дополнительные расходы

**Что нужно:**
- VPS с Node.js/Python сервером
- Проксирование HTTP/WebSocket запросов

---

## Изменения в приложении для поддержки удаленного доступа

### 1. Поддержка HTTPS/WSS

Текущий код использует только HTTP. Нужно добавить поддержку HTTPS:

```dart
// endpoints.dart
static String baseUrl(String host, [String? port, bool useHttps = false]) {
  final protocol = useHttps ? 'https' : 'http';
  final portStr = port != null && port.isNotEmpty ? ':$port' : '';
  return '$protocol://$host$portStr';
}

static String wsUrl(String host, [String? port, bool useHttps = false]) {
  final protocol = useHttps ? 'wss' : 'ws';
  final portStr = port != null && port.isNotEmpty ? ':$port' : '';
  return '$protocol://$host$portStr/ws';
}
```

### 2. Поддержка доменных имен

Текущий код уже поддерживает домены, но нужно добавить валидацию.

### 3. Настройка SSL сертификатов

Для HTTPS нужно настроить проверку сертификатов (или отключить для самоподписанных).

---

## Рекомендуемый подход

**Для домашнего использования:** VPN (WireGuard/Tailscale)
- Самый безопасный
- Не требует изменений в коде
- Работает везде где есть интернет

**Для публичного доступа:** HTTPS + Port Forwarding + DDNS
- Прямой доступ
- Нужно настроить HTTPS на ESP32
- Требует изменений в приложении

